<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Covid19MM Admin Dashboard</title>
		<link
			href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200"
			rel="stylesheet"
		/>
		<link
			href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css"
			rel="stylesheet"
		/>

		<!-- CSS Files -->
		<link href="../assets/css/bootstrap.min.css" rel="stylesheet" />
		<link href="../assets/css/pop.css" rel="stylesheet" />
		<link
			href="../assets/css/paper-dashboard.css?v=2.0.1"
			rel="stylesheet"
		/>
		<link
			href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
			rel="stylesheet"
		/>

		<!-- CSS Just for demo purpose, don't include it in your project -->
		<link href="../assets/demo/demo.css" rel="stylesheet" />
		<style>
			/* The Modal (background) */
			.modal {
				display: none;
				/* Hidden by default */
				position: fixed;
				/* Stay in place */
				z-index: 1;
				/* Sit on top */
				left: 0;
				top: 0;
				width: 100%;
				/* Full width */
				height: 100%;
				/* Full height */
				overflow: auto;
				/* Enable scroll if needed */
				background-color: rgb(0, 0, 0);
				/* Fallback color */
				background-color: rgba(0, 0, 0, 0.4);
				/* Black w/ opacity */
			}

			/* Modal Content/Box */
			.modal-content {
				background-color: #fefefe;
				margin: 15% auto;
				/* 15% from the top and centered */
				padding: 20px;
				border: 1px solid #888;
				width: 80%;
				/* Could be more or less, depending on screen size */
			}

			/* The Close Button */
			.close {
				color: #aaa;
				float: right;
				font-size: 28px;
				font-weight: bold;
			}

			.close:hover,
			.close:focus {
				color: black;
				text-decoration: none;
				cursor: pointer;
			}
		</style>
	</head>
	<body>
		<div class="wrapper">
			<div class="sidebar" data-color="white" data-active-color="danger">
				<div class="logo">
					<a href="" class="simple-text logo-mini">
						<div class="logo-image-small">
							<img src="../assets/img/default-avatar.png">
						</div>
					</a>
			
					<a href="" class="simple-text logo-normal" style="font-size: 25px; color: black; font-weight: 500;"
					id="adminName">Admin</a>
				</div>
				<div class="sidebar-wrapper" style="overflow:scroll">
					<ul class="nav">
						<li>
							<a href="#">
							<!--<i class="nc-icon nc-single-02"></i>-->
								<div>
									<p style="color: blue; font-weight: 530; font-size: 14px;">
									Add More
									<!--&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&ensp;&nbsp;-->
										<form action="/api/generate/" enctype="multipart/form-data" method="post">
											<input type="file" name="file-to-upload">
											<input type="submit" value="Upload">
										</form>
									<!--<span class="fa fa-plus-circle fa-fw" style="font-size:22px;"></span>-->
									</p>
								</div>
							</a>
						</li>
						<hr>
					</ul>
				</div>
			</div>
		
			<div class="main-panel">
				<!-- Navbar -->
				<nav class="navbar navbar-expand-lg navbar-absolute fixed-top navbar-transparent">
					<div class="container-fluid" style="background-color: blue;">
					<div class="navbar-wrapper">
						<div class="navbar-toggle">
						<button type="button" class="navbar-toggler">
							<span class="navbar-toggler-bar bar1"></span>
							<span class="navbar-toggler-bar bar2"></span>
							<span class="navbar-toggler-bar bar3"></span>
						</button>
						</div>
						<a class="navbar-brand" style="color: white;">Dashboard</a>
					</div>
					<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation"
						aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
						<span class="navbar-toggler-bar navbar-kebab"></span>
						<span class="navbar-toggler-bar navbar-kebab"></span>
						<span class="navbar-toggler-bar navbar-kebab"></span>
					</button>
					</div>
				</nav>
				<!-- End Navbar -->
				<div class="content">
					<div class="row">
						<div class="col-md-12">
							<div class="card">
								<div class="card-header">
									<h4 class="card-title"> Contacts Phone Number</h4>
								</div>
					
					
								<div id="search">
									<button type="submit"
									style="width: 100px; float: right; margin-right: 20px; margin-top: 0; border-radius:6%;"
									onclick="PopUpTheForm(this)" id="Search">Search</button>
					
								</div>
					
								<div class="card-body">
									<div class="table-responsive" style="height: 55vh;">
										<table class="table" style="table-layout: auto; width: 100%;height:100px">
											<thead class=" text-primary" style="background-color: blue; text-align: center;" id="TableHead">
											</thead>
											<tbody id="TableBody"></tbody>
										</table>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!--- end table-->

				<!-- The Modal -->
				<div id="popSearchDiv" class="modal">
					<!-- Modal Content -->
					<form class="modal-content animate" id="popupSearchForm" action="">
						<div class="imgcontainer" id="popupSearchHead">
						</div>
						<div class="container" id="popupSearchBody">
						</div>
					</form>
				</div>
	
				<div id="popAddDiv" class="modal">
					<!-- Modal Content -->
					<form class="modal-content animate" id="popupAddForm" action="" method="POST">
						<div class="imgcontainer" id="popupAddHead">
						</div>
						<div class="container" id="popupAddBody">
						</div>
					</form>
				</div>
		
				<div id="popUpdateDiv" class="modal">
					<!-- Modal Content -->
					<form class="modal-content animate" id="popupUpdateForm" action="" method="POST">
						<div class="imgcontainer" id="popupUpdateHead">
						</div>
						<div class="container" id="popupUpdateBody">
						</div>
					</form>
				</div>
			
				<div id="popDeleteDiv" class="modal">
					<!-- Modal Content -->
					<form class="modal-content animate" id="popupDeleteForm" action="" method="POST">
						<div class="imgcontainer" id="popupDeleteHead">
						</div>
						<div class="container" id="popupDeleteBody">
						</div>
					</form>
				</div>
			
				<div style="margin-left: 50px; color: blue;">
			
					<p>
						<a style="color: blue;float: left;" onclick="PopUpTheForm(this)" id="Add">Add more data &nbsp;
							<span class="fa fa-plus-circle fa-fw" style="font-size:22px;"></span>
						</a>
					</p>
			
					<p>
						<a href="http://localhost:3000/api/generate/prepareData" style="color: blue;float: left;">Prepare Data &nbsp;
					</p>
			
					<p>
						<a href="http://localhost:3000/api/generate/createModels" style="color: blue;float: left;">Create Models
						&nbsp;
					</p>
			
					<p>
						<a href="http://localhost:3000/api/generate/loadModules" style="color: blue;float: left;">Load Modules &nbsp;
					</p>
			
					<p>
						<a href="http://localhost:3000/api/generate/loadData" style="color: blue;float: left;">Load Data &nbsp;
					</p>
			
					<p>
						<a href="http://localhost:3000/api/generate/createRoutes" style="color: blue;float: left;">Create Routes
						&nbsp;
					</p>
			
					<p>
						<a href="http://localhost:3000/api/generate/loadRoutes" style="color: blue;float: left;">Load Routes &nbsp;
					</p>
			
					<div style="float:right;margin-right: 10%;width: 10%;">
						<p>
							<a style="color: blue;float: left;" onclick="PopUpTheForm(this)" id="Delete">
								<span class="fa fa-trash" style="font-size:30px;"></span>
							</a>
				
							<a style="color: blue;float: right;" onclick="PopUpTheForm(this)" id="Update">
								<span class="fa fa-edit" style="font-size:30px;"></span>
							</a>
						</p>
					</div>
				</div>
			</div>
		</div>

		<!--   Core JS Files   -->
		<script src="../assets/js/core/jquery.min.js"></script>
		<script src="../assets/js/core/popper.min.js"></script>
		<script src="../assets/js/core/bootstrap.min.js"></script>
		<script src="../assets/js/plugins/perfect-scrollbar.jquery.min.js"></script>
	  
		<!-- Chart JS -->
		<script src="../assets/js/plugins/chartjs.min.js"></script>
	  
		<!--  Notifications Plugin    -->
		<script src="../assets/js/plugins/bootstrap-notify.js"></script>
	  
		<!-- Control Center for Now Ui Dashboard: parallax effects, scripts for the example pages etc -->
		<script src="../assets/js/paper-dashboard.min.js?v=2.0.1" type="text/javascript"></script>
	  
		<!-- Paper Dashboard DEMO methods, don't include it in your project! -->
		<script src="../assets/demo/demo.js"></script>
		<script src="../assets/js/utils.js"></script>

		<script>
			const apihost = "http://localhost:3000/api";

			var selectedId;
			var TheObj;
			var allNav = [];
			var currentNav;
			var count = 0;
			var length = 0;
			var aLength = 0;

			var pSearchArr = [];
			var dataArr = [];
			var valueSearchArr = [];
			var searchTableArr = [];
			var idArr = [];

			function TableLoader(ele) {
				count = 0;
				length = 0;
				aLength = 0;
				dataArr = [];
				idArr = [];
				currentNav = ele;
				Ttitle = document.getElementsByClassName("card-title");
				Ttitle = Ttitle[0];
				Ttitle.innerHTML = ele;
				Thead = document.getElementById("TableHead");
				Tbody = document.getElementById("TableBody");
				Thead.innerHTML = "";
				Tbody.innerHTML = "";

				fetch(`${apihost}/generate/api/${ele}?token=${getcookie("token")}`)
				.then(res => res.json())
				.then(res => {
					if(res.code == 200) {
						data = res.data;
						obj = data;
						TheObj = obj[0];
						pSearchArr = [];
						for (var p in TheObj) {
							if (TheObj.hasOwnProperty(p)) {
								if (p != "_id" && p != "__v") {

									var Th = document.createElement("th");
									Th.style = "color:white;";
									Th.innerHTML = p;
									Thead.appendChild(Th);

								}
								else if (p == "_id") {
									var Th = document.createElement("th");
									Th.style = "color:white;";
									Thead.appendChild(Th);
								}
								pSearchArr.push(p);
							}
						}
						
						idArr = [];
						var makeChecked = true;
						data.forEach(element => {
							var obj = element;
							var Tr = document.createElement("tr");
							Tr.style = "text-align: center;";
							for (var p in obj) {
								if (obj.hasOwnProperty(p)) {
									if (p != "_id" && p != "__v") {
										var Td = document.createElement("td");
										Td.innerHTML = obj[p];
										Tr.appendChild(Td);
										var caseChg = obj[p].toLowerCase();
										dataArr.push(caseChg);
									}
									else if (p == "_id") {
										var Td = document.createElement("td");
										var In = document.createElement("input");
										In.type = "radio";
										In.name = p;
										In.value = obj[p];

										idArr.push(In.value);

										In.onclick = function () { clicker(this) };
										if (makeChecked) {
											makeChecked = false;
											In.checked = true;
											selectedId = obj[p];

										}
										Td.appendChild(In);
										Tr.id = obj[p];
										Tr.appendChild(Td);
									}
								}
							}
							Tbody.appendChild(Tr);
							count++;
						});
						PopUpCreation();
					}
				});
			}

			function PopUpCreation() {
				try {
					console.log("New Forms created");

					var formheadSearch = document.getElementById("popupSearchHead");
					var formheadAdd = document.getElementById("popupAddHead");
					var formheadUpdate = document.getElementById("popupUpdateHead");
					var formheadDelete = document.getElementById("popupDeleteHead");

					formheadSearch.innerHTML = "";
					formheadAdd.innerHTML = "";
					formheadUpdate.innerHTML = "";
					formheadDelete.innerHTML = "";

					var formPopAdd = document.getElementById("popupAddForm");
					var formPopUpdate = document.getElementById("popupUpdateForm");
					var formPopDelete = document.getElementById("popupDeleteForm");

					formPopAdd.action = "/api/generate/api/" + currentNav;
					formPopUpdate.action = "/api/generate/api/" + currentNav + "/" + selectedId;
					formPopDelete.action = "/api/generate/api/" + currentNav + "/" + selectedId;

					var HSearch = document.createElement("h1");
					var HAdd = document.createElement("h1");
					var HUpdate = document.createElement("h1");
					var HDelete = document.createElement("h1");

					HSearch.innerHTML = "Search";
					formheadSearch.appendChild(HSearch);
					HAdd.innerHTML = "Add";
					formheadAdd.appendChild(HAdd);
					HUpdate.innerHTML = "Update";
					formheadUpdate.appendChild(HUpdate);
					HDelete.innerHTML = "Delete";
					formheadDelete.appendChild(HDelete);

					var formbodySearch = document.getElementById("popupSearchBody");
					var formbodyAdd = document.getElementById("popupAddBody");
					var formbodyUpdate = document.getElementById("popupUpdateBody");
					var formbodyDelete = document.getElementById("popupDeleteBody");

					formbodySearch.innerHTML = "";
					formbodyAdd.innerHTML = "";
					formbodyUpdate.innerHTML = "";
					formbodyDelete.innerHTML = "";

					for (var p in TheObj) {
						if (TheObj.hasOwnProperty(p)) {
							if (p != "_id" && p != "__v") {

								var labeltagSearch = document.createElement("label");
								var btagSearch = document.createElement("b");

								var labeltagAdd = document.createElement("label");
								var btagAdd = document.createElement("b");
								var labeltagUpdate = document.createElement("label");
								var btagUpdate = document.createElement("b");

								btagSearch.innerHTML = p;
								labeltagSearch.appendChild(btagSearch);

								btagAdd.innerHTML = p;
								labeltagAdd.appendChild(btagAdd);
								btagUpdate.innerHTML = p;
								labeltagUpdate.appendChild(btagUpdate);

								formbodySearch.appendChild(labeltagSearch);

								formbodyAdd.appendChild(labeltagAdd);
								formbodyUpdate.appendChild(labeltagUpdate);

								var inputtagSearch = document.createElement("input");

								inputtagSearch.type = "text";
								inputtagSearch.placeholder = "Enter " + p;
								inputtagSearch.name = p;
								inputtagSearch.setAttribute("id", `${p}`);
								formbodySearch.appendChild(inputtagSearch);

								var inputtagAdd = document.createElement("input");
								inputtagAdd.type = "text";
								inputtagAdd.placeholder = "Enter " + p;
								inputtagAdd.name = p;
								inputtagAdd.required = true;
								formbodyAdd.appendChild(inputtagAdd);

								var inputtagUpdate = document.createElement("input");
								inputtagUpdate.type = "text";
								inputtagUpdate.placeholder = "Enter " + p;
								inputtagUpdate.name = p;
								inputtagUpdate.required = true;
								formbodyUpdate.appendChild(inputtagUpdate);
							}
						}
					}

					var ActionBtn = document.createElement("button");
					ActionBtn.type = "button";
					ActionBtn.innerHTML = "Search";
					formbodySearch.appendChild(ActionBtn);

					ActionBtn.setAttribute("id", "searchBtn");

					var ActionBtn = document.createElement("button");
					ActionBtn.type = "submit";
					ActionBtn.innerHTML = "Add";
					formbodyAdd.appendChild(ActionBtn);

					var ActionBtn = document.createElement("button");
					ActionBtn.type = "submit";
					ActionBtn.innerHTML = "Update";
					formbodyUpdate.appendChild(ActionBtn);

					var ActionBtn = document.createElement("button");
					ActionBtn.type = "submit";
					ActionBtn.innerHTML = "Delete";
					formbodyDelete.appendChild(ActionBtn);

					var CancelBtnSearch = document.createElement("button");
					CancelBtnSearch.className = "cancelbtn";
					CancelBtnSearch.innerHTML = "Cancel";
					CancelBtnSearch.type = "button";
					CancelBtnSearch.onclick = function () {
						document.getElementById('popSearchDiv').style.display = 'none';
					}
					formbodySearch.appendChild(CancelBtnSearch);

					var CancelBtnAdd = document.createElement("button");
					CancelBtnAdd.className = "cancelbtn";
					CancelBtnAdd.innerHTML = "Cancel";
					CancelBtnAdd.type = "button";
					CancelBtnAdd.onclick = function () {
						document.getElementById('popAddDiv').style.display = 'none';
					}
					formbodyAdd.appendChild(CancelBtnAdd);

					var CancelBtnUpdate = document.createElement("button");
					CancelBtnUpdate.className = "cancelbtn";
					CancelBtnUpdate.innerHTML = "Cancel";
					CancelBtnUpdate.type = "button";
					CancelBtnUpdate.onclick = function () {
						document.getElementById('popUpdateDiv').style.display = 'none';
					}
					formbodyUpdate.appendChild(CancelBtnUpdate);

					var CancelBtnDelete = document.createElement("button");
					CancelBtnDelete.className = "cancelbtn";
					CancelBtnDelete.innerHTML = "Cancel";
					CancelBtnDelete.type = "button";
					CancelBtnDelete.onclick = function () {
						document.getElementById('popDeleteDiv').style.display = 'none';
					}
					formbodyDelete.appendChild(CancelBtnDelete);

				} catch (e) {
					console.log(e);
				}
			}

			function PopUpTheForm(params) {
				console.log(params.id);

				if (params.id == "Add") {
					var formPopAdd = document.getElementById("popupAddForm");
					formPopAdd.action = "/api/generate/api/" + currentNav;
					document.getElementById('popAddDiv').style.display = 'block';
				}
				if (params.id == "Update") {
					var formPopUpdate = document.getElementById("popupUpdateForm");
					formPopUpdate.action = "/api/generate/api/" + currentNav + "/" + selectedId;

					var Tr = document.getElementById(selectedId);
					var formbodyUpdate = document.getElementById("popupUpdateBody");
					var formNodes = formbodyUpdate.childNodes;
					var count = 1;
					var nodes = Tr.childNodes;
					var flag = false;

					nodes.forEach(element => {
						if (element.childElementCount == 0) {
							formNodes[count].value = element.innerHTML;
							count += 2;
						}
					});
					document.getElementById('popUpdateDiv').style.display = 'block';
				}
				if (params.id == "Delete") {
					var formPopDelete = document.getElementById("popupDeleteForm");
					formPopDelete.action = "/api/generate/api/" + currentNav + "/" + selectedId;
					document.getElementById('popDeleteDiv').style.display = 'block';
				}

				if (params.id == "Search") {
					document.getElementById('popSearchDiv').style.display = 'block';

					var searchBtn = document.getElementById("searchBtn");

					searchBtn.addEventListener('click', () => {
						document.getElementById('popSearchDiv').style.display = 'none';
						valueSearchArr = [];
						for (i in pSearchArr) {

							if (pSearchArr[i] != "_id" && pSearchArr[i] != "__v") {
								var pId = document.getElementById(pSearchArr[i]);
								var value = pId.value;
								var caseChg2 = value.toLowerCase();

								valueSearchArr.push(caseChg2);
							}
						}

						searchValue();
					});
				}
			}

			function searchValue() {

				var length = dataArr.length;
				var aLength = length / count;

				var mCount = 0;
				var tCount = 0;

				searchTableArr = [];
				for (var i = 0; i < length; i++) {
					mCount = 0;
					tCount = 0;

					for (var j = 0; j < aLength; j++) {
						if (valueSearchArr[j] != "") {
							mCount++;
						}
						if (valueSearchArr[j] == dataArr[j + (aLength * i)]) {
							tCount++;
						}
					}

					if (tCount == mCount) {
						
						var trueRow = (j + (aLength * i)) / aLength;
						Math.ceil(trueRow);

						searchTableArr.push(i);
					}

				}
				searchTableLoader();
			}

			function searchTableLoader() {
				var sTableLength = searchTableArr.length;
				var idArrLength = idArr.length;

				for (var i = 0; i < sTableLength; i++) {
					var index = searchTableArr[i];
					idArr.splice(index - i, 1);
				}

				for (var j = 0; j < idArr.length; j++) {
					var sTableDel = document.getElementById(idArr[j]);
					sTableDel.innerHTML = "";
				}

				var tableBody = document.getElementById("TableBody");

				if (idArr.length == count) {
					var tr = document.createElement("tr");
					tr.innerHTML = `<td colspan = ${aLength}> No data matched </td>`;
					tr.style = "text-align: center; color: red;";
					tableBody.appendChild(tr);
				}
			}

			function clicker(params) {
				console.log(params);
				selectedId = params.value;
			}

			function start()
			{
				$("#adminName").html("FIX LATER");

				// check for token
				if(getcookie("token") == "") { document.location = "./login.html"; }

				// load collections
				fetch(`${apihost}/admin/collections?token=${getcookie("token")}`)
				.then(res => res.json())
				.then(res => {
					if(res.code == 200) {
						createnav(res.data);
					}
				});
			}

			function createnav(data) {

				var apiloader = true;
				var ultag = document.getElementsByClassName("nav");
				ultag = ultag[0];

				data.forEach(ele => {
					allNav.push(ele);
					var textnode = document.createTextNode(ele);
					var ptag = document.createElement("p");
					ptag.style = "color: blue; font-weight: 530; font-size: 14px;";
					var atag = document.createElement("a");
					var litag = document.createElement("li");
					if (apiloader) {
						litag.id = ele;
						litag.onload = TableLoader(ele);
						litag.onload = function () { TableLoader(ele) };
						litag.onclick = function () { TableLoader(ele) };
						apiloader = false;
					}
					else {
						litag.id = ele;
						litag.onclick = function () { TableLoader(ele) };
					}
					ptag.appendChild(textnode);
					atag.appendChild(ptag);
					litag.appendChild(atag);
					ultag.appendChild(litag);
				});
			}

			$(window).on("load", start);
		</script>
	</body>
</html>
